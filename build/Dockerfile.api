FROM golang:1.22.0-alpine AS builder

COPY . /github.com/web-api/
WORKDIR /github.com/web-api/

RUN go mod download
RUN go clean --modcache
RUN CGO_ENABLED=0 GOOS=linux go build -mod=readonly -o api ./cmd/app/main.go

RUN chmod +x ./api

FROM scratch AS runner

WORKDIR /docker-api/
COPY --from=builder /github.com/web-api/api .

EXPOSE 8080

ENTRYPOINT ["./api"]